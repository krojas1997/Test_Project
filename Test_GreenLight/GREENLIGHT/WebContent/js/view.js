define("modules/home/collection",["base"],function(t){"use strict";return{Themes:t.Collection.extend({url:"public/theme/stack/",model:t.Model.extend({url:"public/theme/stack/"})}),Books:t.Collection.extend({url:"public/stream/book/",parseRecords:function(s,e){return _.shuffle(t.Collection.prototype.parseRecords.apply(this,arguments))},model:t.Model.extend({initialize:function(t,s){this.attributes.is_awarded=!1}})})}}),define("modules/home/view",["base","./collection","helpers/list/book/view","helpers/item/stack/view","helpers/modal/publish/view","helpers/modal/signup/view","util","moment"],function(t,s,e,i,o,n,r,a){"use strict";var l=new s.Themes,c=function(){new h({collection:l}),window.isMobile?l.trigger("listRendered"):$(".first-row .slider .left").after(new d({collection:l}).el)},h=t.View.extend({el:$(".home"),events:{"click .btn-start":"startNow","click .slider-icon.left":"slideLeft","click .slider-icon.right":"slideRight","click .icon-search":"onSearchHandler","keyup .form-control":"onSearchHandler"},initialize:function(){this.listenTo(this.collection,"listRendered",this.render)},render:function(){var t=this.$(".slider .book-list");if(this.$originalItemList=t.children(),this.bookWidth=t.children().first().outerWidth(),this.sliderWidth=this.$originalItemList.length*this.bookWidth,window.hasTouch){var i=this.$(".slider");i.css({"overflow-x":"scroll"}),this.$originalItemList.length%2==0?i.scrollLeft(Math.abs((this.sliderWidth-this.$(".slider").width())/2-this.bookWidth/2)):i.scrollLeft(Math.abs((this.sliderWidth-this.$(".slider").width())/2))}else this.$(".slider .slider-icon").removeClass("hidden"),this.sliderInit();return this.bookList=new e({el:$(".book-content"),collection:new s.Books({},{data:{dialect:window.langid}}),config:{lazyLoad:Calameo.Constant.lazyLoad,stateClass:function(){var t=["clickable"];return this.model.get("creation")>=a().subtract(2,"days").unix()&&t.push("new"),t.join(" ")}}}).on("list:loadmore",function(t){r.analytics.track(window.module,"loadmore","stream",t.collection.state.currentPage)}),this},sliderInit:function(){this.translateX=-Math.abs(this.$originalItemList.length*this.bookWidth/3-this.bookWidth/2),$(".slider .book-list").css({"-webkit-transform":"translate("+this.translateX+"px, 0)","-moz-transform":"translate("+this.translateX+"px, 0)","-ms-transform":"translate("+this.translateX+"px, 0)","-o-transform":"translate("+this.translateX+"px, 0)",transform:"translate("+this.translateX+"px, 0)"}),setTimeout(function(){$(".slider .book-list").css({"-webkit-transition":"-webkit-transform 1s ease","-moz-transition":"-moz-transform 1s ease","-o-transition":"-o-transform 1s ease",transition:"transform 1s ease"})},100)},startNow:function(t){r.analytics.track(window.module,"call to action",$(t.currentTarget).data("type"))},slideLeft:function(t){var s=this;return t.preventDefault(),r.analytics.track(window.module,"left","themes"),s.inprogress?!1:(s.inprogress=!0,$(".slider .book-list").css({"-webkit-transition":"-webkit-transform 1s ease","-moz-transition":"-moz-transform 1s ease","-o-transition":"-o-transform 1s ease",transition:"transform 1s ease"}),$(".slider .book-list").css({"-webkit-transform":"translate("+(this.translateX+3*this.bookWidth)+"px, 0)","-moz-transform":"translate("+(this.translateX+3*this.bookWidth)+"px, 0)","-ms-transform":"translate("+(this.translateX+3*this.bookWidth)+"px, 0)","-o-transform":"translate("+(this.translateX+3*this.bookWidth)+"px, 0)",transform:"translate("+(this.translateX+3*this.bookWidth)+"px, 0)"}),void setTimeout(function(){$(".slider .book-list").children().slice(-3).prependTo(".slider .book-list"),$(".slider .book-list").css({"-webkit-transition":"none","-moz-transition":"none","-o-transition":"none",transition:"none"}),$(".slider .book-list").css({"-webkit-transform":"translate("+s.translateX+"px, 0)","-moz-transform":"translate("+s.translateX+"px, 0)","-ms-transform":"translate("+s.translateX+"px, 0)","-o-transform":"translate("+s.translateX+"px, 0)",transform:"translate("+s.translateX+"px, 0)"}),s.inprogress=!1},1e3))},slideRight:function(t){var s=this;return t.preventDefault(),r.analytics.track(window.module,"right","themes"),s.inprogress?!1:(s.inprogress=!0,$(".slider .book-list").css({"-webkit-transition":"-webkit-transform 1s ease","-moz-transition":"-moz-transform 1s ease","-o-transition":"-o-transform 1s ease",transition:"transform 1s ease"}),$(".slider .book-list").css({"-webkit-transform":"translate("+(this.translateX-3*this.bookWidth)+"px, 0)","-moz-transform":"translate("+(this.translateX-3*this.bookWidth)+"px, 0)","-ms-transform":"translate("+(this.translateX-3*this.bookWidth)+"px, 0)","-o-transform":"translate("+(this.translateX-3*this.bookWidth)+"px, 0)",transform:"translate("+(this.translateX-3*this.bookWidth)+"px, 0)"}),void setTimeout(function(){$(".slider .book-list").children().slice(0,3).appendTo(".slider .book-list"),$(".slider .book-list").css({"-webkit-transition":"none","-moz-transition":"none","-o-transition":"none",transition:"none"}),$(".slider .book-list").css({"-webkit-transform":"translate("+s.translateX+"px, 0)","-moz-transform":"translate("+s.translateX+"px, 0)","-ms-transform":"translate("+s.translateX+"px, 0)","-o-transform":"translate("+s.translateX+"px, 0)",transform:"translate("+s.translateX+"px, 0)"}),s.inprogress=!1},1e3))},onSearchHandler:function(t){return(13===t.keyCode||"click"===t.type&&$(t.currentTarget).hasClass("icon-search"))&&this.search(),!1},search:function(){var t=this.$(".form-control").val();this.$(".search").toggleClass("focused",""!==t),"/search"!==window.location.pathname?window.location.href=window.location.protocol+"//"+window.location.hostname+"/search#search-"+t:(paramObject.update({search:t}),location.reload())}}),d=t.View.extend({className:"book-list container",initialize:function(){this.listenTo(this.collection,"reset",this.render),this.collection.fetch({reset:!0,data:{language:window.langid}})},render:function(){return this.$el.html(""),window.hasTouch?this.collection.each(function(t){this.addItem(t,this.collection)},this):_(3).times(function(){this.collection.each(function(t){this.addItem(t,this.collection)},this)},this),this.collection.trigger("listRendered"),this},addItem:function(t,s,e){this.$el.append(new i({model:t,className:"book stack fade book-column col-xs-12 col-ms-6 col-sm-3",link:"themes/"+t.get("reference")}).el)}});c()});